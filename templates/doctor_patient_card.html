{% extends "base.html" %}

{% block title %}–í—Ä–∞—á - –ö–∞—Ä—Ç–∞ –ø–∞—Ü–∏–µ–Ω—Ç–∞{% endblock %}

{% block content %}
<div style="display: grid; grid-template-columns: 1fr 300px; gap: 20px; align-items: start;">
    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <div>
        <div class="card">
            <h3>üìã {{ data.patient.surname }} {{ data.patient.name }} {{ data.patient.patronim or '' }}</h3>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;">
                <div>
                    <div style="font-size: 0.8rem; color: #666;">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</div>
                    <div>{{ data.patient.birth_date }}</div>
                </div>
                <div>
                    <div style="font-size: 0.8rem; color: #666;">–ü–æ–ª</div>
                    <div>{{ '–ú—É–∂—Å–∫–æ–π' if data.patient.gender == '–º' else '–ñ–µ–Ω—Å–∫–∏–π' }}</div>
                </div>
                <div>
                    <div style="font-size: 0.8rem; color: #666;">–†–æ—Å—Ç</div>
                    <div>{{ data.patient.height or '-' }} —Å–º</div>
                </div>
                <div>
                    <div style="font-size: 0.8rem; color: #666;">–í–µ—Å</div>
                    <div>{{ data.patient.weight or '-' }} –∫–≥</div>
                </div>
            </div>
        </div>

        {% if chart_url %}
        <div class="chart-container">
            <h3>–ì—Ä–∞—Ñ–∏–∫–∏ –∏–∑–º–µ—Ä–µ–Ω–∏–π</h3>
            <img src="data:image/png;base64,{{ chart_url }}" alt="–ì—Ä–∞—Ñ–∏–∫–∏" style="max-width: 100%;">
        </div>
        {% endif %}

        <!-- –í–∫–ª–∞–¥–∫–∏ -->
        <div class="tabs">
            <button class="tab active">–ò–∑–º–µ—Ä–µ–Ω–∏—è</button>
            <button class="tab">–ù–∞–∑–Ω–∞—á–µ–Ω–∏—è</button>
            <button class="tab">–ñ–∞–ª–æ–±—ã</button>
        </div>

        <!-- –¢–∞–±–ª–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏–π -->
        <div class="table-responsive" style="margin-bottom: 20px;">
            <table>
                <thead>
                    <tr>
                        <th>–î–∞—Ç–∞</th>
                        <th>–ì–ª—é–∫–æ–∑–∞</th>
                        <th>–î–∞–≤–ª–µ–Ω–∏–µ</th>
                        <th>–ü—É–ª—å—Å</th>
                        <th>–í–µ—Å</th>
                    </tr>
                </thead>
                <tbody>
                    {% for m in data.measurements[:10] %}
                    <tr>
                        <td>{{ m.measured_at[:10] }}</td>
                        <td>{{ m.glucose or '-' }}</td>
                        <td>{{ m.systolic_bp }}/{{ m.diastolic_bp }}</td>
                        <td>{{ m.pulse or '-' }}</td>
                        <td>{{ m.weight or '-' }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –î–µ–π—Å—Ç–≤–∏—è –≤—Ä–∞—á–∞ -->
    <div>
        <div class="actions-card">
            <h3>–î–µ–π—Å—Ç–≤–∏—è</h3>
            <div class="action-buttons-vertical">
                <button class="btn btn-primary" style="width: 100%; text-align: left;">‚ûï –ù–∞–∑–Ω–∞—á–∏—Ç—å –ª–µ—á–µ–Ω–∏–µ</button>
                <button class="btn btn-secondary" style="width: 100%; text-align: left;">üìù –í—ã–ø–∏—Å–∞—Ç—å —Ä–µ—Ü–µ–ø—Ç</button>
                <button class="btn btn-secondary" style="width: 100%; text-align: left;">ü©∫ –ù–∞–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –∞–Ω–∞–ª–∏–∑—ã</button>
                <button class="btn btn-secondary" style="width: 100%; text-align: left;">üìÖ –ó–∞–ø–∏—Å–∞—Ç—å –Ω–∞ –ø—Ä–∏—ë–º</button>
                <hr style="margin: 15px 0; border: none; border-top: 1px solid #ddd;">
                <button class="btn btn-secondary" style="width: 100%; text-align: left;">üìÑ –ò—Å—Ç–æ—Ä–∏—è –±–æ–ª–µ–∑–Ω–∏</button>
                <button class="btn btn-secondary" style="width: 100%; text-align: left;">üñ®Ô∏è –ü–µ—á–∞—Ç—å –∫–∞—Ä—Ç—ã</button>
            </div>
        </div>

        <div class="card" style="margin-top: 20px;">
            <h3>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è</h3>
            {% for p in data.prescriptions[:3] %}
            <div style="border-bottom: 1px solid #eee; padding: 10px 0;">
                <div><strong>{{ p.medication_name }}</strong></div>
                <div style="font-size: 0.85rem; color: #666;">{{ p.quantity }} {{ p.dose_unit }} ¬∑ {{ p.frequency }}</div>
                <div style="font-size: 0.8rem;">—Å {{ p.start_date[:10] }} ¬∑ {{ p.status }}</div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<a href="{{ url_for('doctor_patients') }}" class="btn btn-secondary" style="margin-top: 20px;">‚Üê –ö —Å–ø–∏—Å–∫—É –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤</a>
{% endblock %}